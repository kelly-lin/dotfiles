#!/bin/zsh

if [[ $# -eq 1 ]]; then
  selected=$1
else
  selected=$(find ~/Repos -mindepth 1 -maxdepth 1 -type d | fzf --reverse)
fi

if [[ -z $selected ]]; then
  exit 0
fi

selected_name=$(basename "$selected" | tr . _)
num_of_worktrees=$(cd $selected && git worktree list &> /dev/null | wc -l)
if [[ $num_of_worktrees -gt 1 ]]; then
  cd $selected && tmuxinator-worktree-sessionizer
else
  tmuxinator start -n $selected_name -p $HOME/.config/tmuxinator/dev.yaml workspace=$selected
fi
